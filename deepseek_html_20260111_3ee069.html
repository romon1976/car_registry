<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–µ—Å—Ç—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π - –°–∏—Ä–µ–Ω–µ–≤–∞—è 31</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }
        
        .search-container {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
        }
        
        .search-box {
            flex: 1;
            min-width: 250px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .search-select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            min-width: 150px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 14px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            vertical-align: top;
        }
        
        th {
            background-color: #4a6fa5;
            color: white;
            cursor: pointer;
            position: sticky;
            top: 0;
        }
        
        th:hover {
            background-color: #3a5a80;
        }
        
        th.sort-asc::after {
            content: " ‚Üë";
            font-weight: bold;
        }
        
        th.sort-desc::after {
            content: " ‚Üì";
            font-weight: bold;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        tr:hover {
            background-color: #e3f2fd;
        }
        
        .editable {
            cursor: pointer;
            min-height: 30px;
            position: relative;
        }
        
        .editable:hover {
            background-color: #bbdefb;
        }
        
        .editable.editing {
            background-color: #e8f4fd;
            padding: 0;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
            padding: 15px;
            background: #e8f4fd;
            border-radius: 6px;
        }
        
        .btn {
            padding: 10px 20px;
            background-color: #4a6fa5;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #3a5a80;
        }
        
        .btn-add {
            background-color: #2e7d32;
        }
        
        .btn-add:hover {
            background-color: #1b5e20;
        }
        
        .btn-save {
            background-color: #6a1b9a;
        }
        
        .btn-save:hover {
            background-color: #4a148c;
        }
        
        .btn-load {
            background-color: #f57c00;
        }
        
        .btn-load:hover {
            background-color: #ef6c00;
        }
        
        .btn-delete {
            background-color: #c62828;
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .btn-delete:hover {
            background-color: #b71c1c;
        }
        
        .btn-export {
            background-color: #1565c0;
        }
        
        .btn-export:hover {
            background-color: #0d47a1;
        }
        
        .stats {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
            font-size: 14px;
            text-align: center;
            border-left: 4px solid #4a6fa5;
        }
        
        .highlight {
            background-color: #fff9c4 !important;
        }
        
        .car-numbers {
            line-height: 1.4;
        }
        
        .edit-input {
            width: 100%;
            height: 100%;
            border: 1px solid #4a6fa5;
            padding: 8px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .date-cell {
            font-family: monospace;
            font-size: 13px;
            color: #666;
        }
        
        .sync-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            font-size: 13px;
        }
        
        .sync-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .sync-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .sync-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            table {
                display: block;
                overflow-x: auto;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn {
                width: 100%;
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöó –†–µ–µ—Å—Ç—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –∂–∏—Ç–µ–ª–µ–π - –°–∏—Ä–µ–Ω–µ–≤–∞—è 31</h1>
        
        <div class="controls">
            <div>
                <button class="btn btn-add" onclick="addNewRow()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                <button class="btn" onclick="clearSearch()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫</button>
            </div>
            <div>
                <button class="btn btn-save" onclick="saveToServer()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä</button>
                <button class="btn btn-load" onclick="loadFromServer()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞</button>
                <button class="btn btn-export" onclick="exportToCSV()">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
            </div>
        </div>
        
        <div id="syncStatus" class="sync-status hidden"></div>
        
        <div class="search-container">
            <select class="search-select" id="searchType">
                <option value="all">–ò—Å–∫–∞—Ç—å –≤–µ–∑–¥–µ</option>
                <option value="apartment">–ü–æ –∫–≤–∞—Ä—Ç–∏—Ä–µ</option>
                <option value="car">–ü–æ –Ω–æ–º–µ—Ä—É –∞–≤—Ç–æ</option>
                <option value="name">–ü–æ –∏–º–µ–Ω–∏</option>
                <option value="phone">–ü–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É</option>
            </select>
            <input type="text" 
                   class="search-box" 
                   id="searchInput" 
                   placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞..."
                   onkeyup="searchTable()">
            <div style="display: flex; align-items: center; gap: 5px;">
                <input type="checkbox" id="highlightMatches" checked onchange="searchTable()">
                <label for="highlightMatches">–ü–æ–¥—Å–≤–µ—Ç–∏—Ç—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è</label>
            </div>
        </div>
        
        <div class="table-container">
            <table id="carTable">
                <thead>
                    <tr>
                        <th data-column="0" onclick="sortTable(0)">–ö–≤–∞—Ä—Ç–∏—Ä–∞</th>
                        <th data-column="1" onclick="sortTable(1)">–¢–µ–ª 1</th>
                        <th data-column="2" onclick="sortTable(2)">–¢–µ–ª 2</th>
                        <th data-column="3" onclick="sortTable(3)">–ì/–ù –∞–≤—Ç–æ–º–æ–±–∏–ª—è</th>
                        <th data-column="4" onclick="sortTable(4)">–ò–º—è</th>
                        <th data-column="5" onclick="sortTable(5)">–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                </tbody>
            </table>
        </div>
        
        <div class="stats" id="stats">
            –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: <span id="totalCount">0</span> | 
            –ù–∞–π–¥–µ–Ω–æ: <span id="filteredCount">0</span> |
            –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span id="lastUpdate">-</span>
        </div>
        
        <!-- –°–∫—Ä—ã—Ç–∞—è —Ñ–æ—Ä–º–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ -->
        <input type="file" id="fileInput" accept=".json" class="hidden" onchange="handleFileUpload(event)">
    </div>

    <script>
        // –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        const originalData = [
            {apartment: "3", phone1: "89951530932", phone2: "", car_number: "O 569 KC 716", name: "–û–ª–µ—Å—è –ó–≤–µ—Ä–µ–≤–∞", date: "2023-10-10"},
            {apartment: "5", phone1: "89139109217", phone2: "", car_number: "–ù 701 –£–ï", name: "", date: "2019-09-29"},
            {apartment: "6", phone1: "89537965224", phone2: "89134731719", car_number: "–ï 314 –û–° 154<br>–ê 707 –†–ù 54", name: "", date: "2019-09-29"},
            {apartment: "10", phone1: "89231500917", phone2: "", car_number: "–ö 462 –ù–• 154", name: "–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω", date: "2025-10-02"},
            {apartment: "14", phone1: "89237047030", phone2: "", car_number: "C 285 –£–ú 154", name: "", date: "2019-09-29"},
            {apartment: "17", phone1: "89628404755", phone2: "", car_number: "–£ 122 –ê–ï 154", name: "–ú–∏—Ö–∞–∏–ª –Ø–¥—Ä–µ–Ω–∫–∏–Ω", date: "2020-07-03"},
            {apartment: "21", phone1: "89133916906", phone2: "", car_number: "X 393 XO 54", name: "", date: "2019-09-29"},
            {apartment: "31", phone1: "89628318242", phone2: "", car_number: "–ù 238 –ö–ï", name: "–ì–æ–Ω—á–∞—Ä–µ–Ω–∫–æ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä", date: "2022-01-03"},
            {apartment: "35", phone1: "89231403100", phone2: "", car_number: "–ú 634 –£–û 54", name: "", date: "2019-09-29"},
            {apartment: "42", phone1: "89139802442", phone2: "", car_number: "–ê 142 –ù–ù 154", name: "–†–æ–º–∞–Ω", date: "2025-05-25"},
            {apartment: "42", phone1: "89139802442", phone2: "", car_number: "–í 040 –¢–û", name: "–†–æ–º–∞–Ω", date: "2025-05-25"},
            {apartment: "44", phone1: "89139217311", phone2: "", car_number: "X 054 BC 54", name: "", date: "2019-09-29"},
            {apartment: "52", phone1: "89139599088", phone2: "", car_number: "–ù 815 –£–£ 154", name: "–ù–∞–¥–µ–∂–¥–∞ –ò–æ—Å–∏—Ñ–æ–≤–Ω–∞", date: "2021-12-22"},
            {apartment: "54", phone1: "89139012254", phone2: "", car_number: "X 060 TO", name: "", date: "2019-09-29"},
            {apartment: "57", phone1: "89139293667", phone2: "", car_number: "O 038 OK 54", name: "–î–º–∏—Ç—Ä–∏–π", date: "2021-12-21"},
            {apartment: "59", phone1: "89139110608", phone2: "", car_number: "C 835 HK 154<br>H 791 AB 154", name: "", date: "2019-09-29"},
            {apartment: "60", phone1: "89139078873", phone2: "89139133763", car_number: "B 018 –£–¢ 27", name: "", date: "2019-09-29"},
            {apartment: "69", phone1: "89609354617", phone2: "", car_number: "B 365 –¢–£ 154", name: "", date: "2019-09-29"},
            {apartment: "81", phone1: "89231204859", phone2: "", car_number: "C 256 –£–ú 54<br>–ö412–í–û154", name: "–í–ª–∞–¥–∏–º–∏—Ä", date: "2021-12-22"},
            {apartment: "82", phone1: "89134840691", phone2: "", car_number: "–ï 567 –û–£", name: "", date: "2019-09-29"},
            {apartment: "83", phone1: "89139535596", phone2: "", car_number: "B 167 AH 54", name: "", date: "2019-09-29"},
            {apartment: "86", phone1: "89134870855", phone2: "", car_number: "–ù–í 110 –í–ê", name: "", date: "2019-09-29"},
            {apartment: "87", phone1: "89139096303", phone2: "89059462644", car_number: "–† 361 –í–ê 154", name: "–ò—Ä–∏–Ω–∞", date: "2025-07-15"},
            {apartment: "92", phone1: "89231550909", phone2: "89231510505", car_number: "–ù 228 –ê–¢", name: "", date: "2019-09-29"},
            {apartment: "98", phone1: "89137567864", phone2: "", car_number: "–† 914 –û–í 54", name: "–ó–æ—è", date: "2021-12-22"},
            {apartment: "99", phone1: "89134877727", phone2: "", car_number: "–† 077 –£–° 22<br>–° 690 –ö–† 04<br>–ï 844 –í–† 154<br>–ï 333 –ê–ê 54", name: "", date: "2019-09-29"},
            {apartment: "100", phone1: "89137139754", phone2: "", car_number: "–ê924–•–ú 154", name: "–ù–∞—Ç–∞–ª—å—è", date: "2024-10-07"},
            {apartment: "106", phone1: "89134643846", phone2: "", car_number: "–ê 269 –£–† 42", name: "–ï–≥–æ—Ä", date: "2020-07-03"},
            {apartment: "107", phone1: "89133957775", phone2: "", car_number: "C 720 PP 154", name: "", date: "2019-09-29"},
            {apartment: "108", phone1: "89139247189", phone2: "", car_number: "A 762 MB", name: "", date: "2019-09-29"},
            {apartment: "111", phone1: "89537643737", phone2: "+79139865823", car_number: "–† 721 –£–• 54", name: "–ò–ª—å—è –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–∏—á", date: "2020-07-02"},
            {apartment: "119", phone1: "89137831512", phone2: "", car_number: "–í 791 –¢–í", name: "", date: "2019-09-29"},
            {apartment: "123", phone1: "89237005109", phone2: "89082103128", car_number: "–† 580 –ö–ú 19", name: "", date: "2019-09-29"},
            {apartment: "125", phone1: "89232584076", phone2: "", car_number: "–ö 846 –°–† 154<br>–† 837–•–† 55", name: "", date: "2021-12-22"},
            {apartment: "129", phone1: "89134541416", phone2: "", car_number: "–† 174 –†–• 54", name: "–ú–∞–∫—Å–∏–º", date: "2022-07-11"},
            {apartment: "133", phone1: "89130151400", phone2: "", car_number: "–ï 656 –¢–ù 154", name: "–ò–≤–∞–Ω", date: "2021-12-22"},
            {apartment: "134", phone1: "89139119583", phone2: "", car_number: "–£ 268 –•–• 54", name: "", date: "2022-12-22"},
            {apartment: "139", phone1: "89139172944", phone2: "89137992790", car_number: "–† 687 –°–• 154<br>–ù 952 –ù–ù 154", name: "–ï–≤–≥–µ–Ω–∏–π", date: "2024-10-07"},
            {apartment: "140", phone1: "89137550855", phone2: "", car_number: "–† 800 –ö–†", name: "–ú–∞—Ä–∏—è", date: "2021-12-23"},
            {apartment: "141", phone1: "89139302827", phone2: "", car_number: "–ê 869 –û–í 154", name: "–ú–∏—Ö–∞–∏–ª", date: "2020-07-02"},
            {apartment: "147", phone1: "89537681854", phone2: "", car_number: "–• 128 –†–° 54", name: "", date: "2019-09-29"},
            {apartment: "148", phone1: "89134754008", phone2: "", car_number: "–í 978 –†–ù 154", name: "", date: "2019-09-29"},
            {apartment: "153", phone1: "89095295152", phone2: "", car_number: "E 730 TK 154", name: "", date: "2019-09-29"},
            {apartment: "153", phone1: "89139179146", phone2: "", car_number: "–ù 191 –¢–• 154", name: "–†–æ–º–∞–Ω", date: "2021-07-10"},
            {apartment: "154", phone1: "89139127850", phone2: "", car_number: "K 906 KE 799", name: "", date: "2019-09-29"},
            {apartment: "156", phone1: "89232331352", phone2: "89529206224", car_number: "–ï 217 –í–• 154<br>–ö 877 –°–ï 154", name: "–†–æ–º–∞–Ω", date: "2020-07-16"},
            {apartment: "158", phone1: "89059514851", phone2: "", car_number: "B 257 TH", name: "", date: "2019-09-29"},
            {apartment: "160", phone1: "89137200415", phone2: "", car_number: "–£ 214 –£–û 22", name: "", date: "2019-09-29"},
            {apartment: "162", phone1: "89130641722", phone2: "", car_number: "–í 294 –ê–ù", name: "", date: "2019-09-29"},
            {apartment: "165", phone1: "89050958080", phone2: "", car_number: "C 437 TX<br>E 984 AT", name: "", date: "2019-09-29"},
            {apartment: "169", phone1: "89130128654", phone2: "", car_number: "P 116 KH 54", name: "", date: "2019-09-29"},
            {apartment: "170", phone1: "89139277720", phone2: "", car_number: "O 414 CP 54", name: "", date: "2019-09-29"},
            {apartment: "171", phone1: "89618766424", phone2: "89137609944", car_number: "–ö 690 –¢–í 154<br>–† 725 –†–ö 154", name: "–î–∞–≤–∏–¥ –°–æ–∫–æ–ª", date: "2024-12-27"},
            {apartment: "172", phone1: "89529493403", phone2: "", car_number: "–£ 604 –£–ï 54", name: "", date: "2019-09-29"},
            {apartment: "173", phone1: "89139555543", phone2: "", car_number: "–£ 179 –†–ú 54", name: "", date: "2019-09-29"},
            {apartment: "174", phone1: "89139453473", phone2: "", car_number: "–ö 287 –†–í 54", name: "", date: "2019-09-29"},
            {apartment: "175", phone1: "89139306563", phone2: "", car_number: "–û 152 –ú–ù 154", name: "", date: "2022-09-15"},
            {apartment: "176", phone1: "89139068796", phone2: "", car_number: "H 561 EE 54", name: "", date: "2019-09-29"},
            {apartment: "177", phone1: "89232440003", phone2: "89607980976", car_number: "C 183 OK 154", name: "", date: "2019-09-29"},
            {apartment: "181", phone1: "89237389188", phone2: "89237383488", car_number: "–í 573 –ê–¢", name: "–û–ª—å–≥–∞/–ê–Ω—Ç–æ–Ω", date: "2021-12-22"},
            {apartment: "183", phone1: "89635010333", phone2: "", car_number: "–ê 250 –û–• 122", name: "–í–µ—Ä–∞", date: "2021-12-22"},
            {apartment: "184", phone1: "89130082006", phone2: "", car_number: "–ö 027 –¢–ù 154", name: "–¢–æ–π–æ—Ç–∞ –ò–ø—Å—É–º –°–µ—Ä–µ–±—Ä–æ", date: "2021-12-22"},
            {apartment: "188", phone1: "89139209080", phone2: "89612250013", car_number: "–† 700 –í–£ 797", name: "–†–æ–º–∞–Ω", date: "2023-09-27"},
            {apartment: "196", phone1: "89833050306", phone2: "89831258370", car_number: "M 367 TO 54", name: "–ê–ª–µ–∫—Å–µ–π", date: "2021-12-23"},
            {apartment: "197", phone1: "89529210508", phone2: "", car_number: "–ê 570 –£–ö 154", name: "", date: "2019-09-29"},
            {apartment: "–æ—Ñ–∏—Å 5", phone1: "89139493800", phone2: "", car_number: "–¢ 077 –í–í, 110 (?)", name: "", date: "2019-09-29"},
            {apartment: "–æ—Ñ–∏—Å 7", phone1: "89139866537", phone2: "", car_number: "P 445 KP", name: "", date: "2019-09-29"},
            {apartment: "", phone1: "89224467394", phone2: "", car_number: "–ú724–†–û", name: "–î–µ–Ω–∏—Å –ê–Ω–∞—Ç–æ–ª—å–µ–≤–∏—á", date: "2020-07-02"},
            {apartment: "", phone1: "89137045804", phone2: "", car_number: "–£ 574 –ê–† 55", name: "–¢–∞—Ç—å—è–Ω–∞", date: "2020-07-02"},
            {apartment: "", phone1: "89137407942", phone2: "", car_number: "–ê 355 –ù–† 124", name: "–ò–≤–∞–Ω", date: "2020-07-10"},
            {apartment: "", phone1: "89231772511", phone2: "", car_number: "–ï 204 –°–• 154", name: "–í–ª–∞–¥–∏–º–∏—Ä", date: "2020-07-04"},
            {apartment: "", phone1: "89231987752", phone2: "", car_number: "–• 797 –£–¢ 42", name: "–ê–ª–µ–∫—Å–µ–π", date: "2020-07-10"}
        ];

        // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let carData = [];
        let currentData = [];
        let sortDirection = {};
        let currentSearch = '';
        let editingCell = null;
        
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞ (–∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π URL)
        const SERVER_CONFIG = {
            // –î–ª—è Google Drive
            googleDrive: false,
            
            // –î–ª—è Dropbox
            dropbox: false,
            
            // –î–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
            serverUrl: 'https://your-server.com/save-data.php', // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π URL
            
            // –†–µ–∂–∏–º –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            localMode: true
        };

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU');
        }

        // –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞
        function getCurrentDate() {
            const now = new Date();
            return now.toISOString().split('T')[0];
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text, type = 'info') {
            const statusDiv = document.getElementById('syncStatus');
            statusDiv.textContent = text;
            statusDiv.className = `sync-status sync-${type}`;
            statusDiv.classList.remove('hidden');
            
            setTimeout(() => {
                statusDiv.classList.add('hidden');
            }, 5000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ LocalStorage
            const saved = localStorage.getItem('sirenevaya31_backup');
            if (saved) {
                try {
                    carData = JSON.parse(saved);
                    showMessage('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫—ç—à–∞', 'info');
                } catch (e) {
                    carData = JSON.parse(JSON.stringify(originalData));
                }
            } else {
                carData = JSON.parse(JSON.stringify(originalData));
            }
            
            currentData = [...carData];
            loadTableData();
            updateLastUpdate();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü—É
        function loadTableData() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            currentData.forEach((row, index) => {
                const tr = document.createElement('tr');
                const originalIndex = carData.findIndex(item => item === row);
                
                tr.innerHTML = `
                    <td class="editable" onclick="editCell(this, ${originalIndex}, 'apartment')">${row.apartment || ''}</td>
                    <td class="editable" onclick="editCell(this, ${originalIndex}, 'phone1')">${row.phone1 || ''}</td>
                    <td class="editable" onclick="editCell(this, ${originalIndex}, 'phone2')">${row.phone2 || ''}</td>
                    <td class="editable" onclick="editCell(this, ${originalIndex}, 'car_number')">${row.car_number || ''}</td>
                    <td class="editable" onclick="editCell(this, ${originalIndex}, 'name')">${row.name || ''}</td>
                    <td class="date-cell">${formatDate(row.date)}</td>
                    <td>
                        <button class="btn-delete" onclick="deleteRow(${originalIndex})">–£–¥–∞–ª–∏—Ç—å</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            updateStats();
        }

        // –ü–æ–∏—Å–∫ –ø–æ —Ç–∞–±–ª–∏—Ü–µ
        function searchTable() {
            const searchType = document.getElementById('searchType').value;
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const highlight = document.getElementById('highlightMatches').checked;
            
            if (!searchText) {
                currentData = [...carData];
                loadTableData();
                return;
            }
            
            currentData = carData.filter(row => {
                let searchString = '';
                switch(searchType) {
                    case 'apartment':
                        searchString = row.apartment || '';
                        break;
                    case 'car':
                        searchString = row.car_number || '';
                        break;
                    case 'name':
                        searchString = row.name || '';
                        break;
                    case 'phone':
                        searchString = (row.phone1 || '') + (row.phone2 || '');
                        break;
                    default:
                        searchString = Object.values(row).join(' ').toLowerCase();
                }
                return searchString.toLowerCase().includes(searchText);
            });
            
            loadTableData();
            
            if (highlight && searchText) {
                highlightMatches(searchText, searchType);
            }
        }

        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ - —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ
        // (–æ–ø—É—â–µ–Ω—ã –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏, –Ω–æ –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–¥–∞)

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        async function saveToServer() {
            try {
                const data = {
                    timestamp: new Date().toISOString(),
                    data: carData
                };
                
                if (SERVER_CONFIG.localMode) {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ LocalStorage –∫–∞–∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
                    localStorage.setItem('sirenevaya31_backup', JSON.stringify(carData));
                    
                    // –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `sirenevaya31_${getCurrentDate()}.json`;
                    a.click();
                    
                    showMessage('–§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ –∏ –≥–æ—Ç–æ–≤ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –æ–±–ª–∞–∫–æ', 'success');
                } else if (SERVER_CONFIG.serverUrl) {
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                    const response = await fetch(SERVER_CONFIG.serverUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });
                    
                    if (response.ok) {
                        showMessage('–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ', 'success');
                    } else {
                        throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                    }
                }
                
                updateLastUpdate();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                showMessage('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç –≤ CSV.', 'error');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function loadFromServer() {
            try {
                if (SERVER_CONFIG.localMode) {
                    // –í –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
                    document.getElementById('fileInput').click();
                } else if (SERVER_CONFIG.serverUrl) {
                    const response = await fetch(SERVER_CONFIG.serverUrl);
                    if (response.ok) {
                        const data = await response.json();
                        carData = data.data;
                        currentData = [...carData];
                        loadTableData();
                        showMessage('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å —Å–µ—Ä–≤–µ—Ä–∞', 'success');
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É.', 'error');
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.data && Array.isArray(data.data)) {
                        carData = data.data;
                        currentData = [...carData];
                        localStorage.setItem('sirenevaya31_backup', JSON.stringify(carData));
                        loadTableData();
                        showMessage('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ —Ñ–∞–π–ª–∞', 'success');
                    } else {
                        showMessage('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞', 'error');
                    }
                } catch (error) {
                    showMessage('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞', 'error');
                }
            };
            reader.readAsText(file);
            
            // –°–±—Ä–æ—Å input
            event.target.value = '';
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
        function exportToCSV() {
            const headers = ['–ö–≤–∞—Ä—Ç–∏—Ä–∞', '–¢–µ–ª 1', '–¢–µ–ª 2', '–ì/–ù –∞–≤—Ç–æ–º–æ–±–∏–ª—è', '–ò–º—è', '–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è'];
            const csvContent = [
                headers.join(','),
                ...carData.map(row => [
                    `"${row.apartment || ''}"`,
                    `"${row.phone1 || ''}"`,
                    `"${row.phone2 || ''}"`,
                    `"${(row.car_number || '').replace(/<br>/g, '; ')}"`,
                    `"${row.name || ''}"`,
                    `"${formatDate(row.date)}"`
                ].join(','))
            ].join('\n');
            
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `–°–∏—Ä–µ–Ω–µ–≤–∞—è_31_–∞–≤—Ç–æ_${getCurrentDate()}.csv`;
            link.click();
            showMessage('–§–∞–π–ª CSV —Å–∫–∞—á–∞–Ω', 'success');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            document.getElementById('totalCount').textContent = carData.length;
            document.getElementById('filteredCount').textContent = currentData.length;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        function updateLastUpdate() {
            const now = new Date();
            const formattedDate = now.toLocaleString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('lastUpdate').textContent = formattedDate;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            init();
            
            // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
            window.addEventListener('beforeunload', function() {
                localStorage.setItem('sirenevaya31_backup', JSON.stringify(carData));
            });
            
            // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(() => {
                localStorage.setItem('sirenevaya31_backup', JSON.stringify(carData));
            }, 30000);
        });

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (sortTable, editCell, finishEditing, addNewRow, deleteRow, clearSearch)
        // –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–¥–∞

    </script>
</body>
</html>